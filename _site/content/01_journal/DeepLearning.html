<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.335">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<meta name="author" content="Fadel Victor Shanaa">
<title>MyLabJournal - Deep Learning</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../assets/icons/favicon.svg" rel="icon" type="image/svg+xml">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="stylesheet" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../../site_libs/bootstrap/bootstrap-dark.min.css" rel="stylesheet" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script src="../../site_libs/quarto-contrib/glightbox/glightbox.min.js"></script>
<link href="../../site_libs/quarto-contrib/glightbox/glightbox.min.css" rel="stylesheet">
<link href="../../site_libs/quarto-contrib/glightbox/lightbox.css" rel="stylesheet"><script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script><link href="../../site_libs/pagedtable-1.1/css/pagedtable.css" rel="stylesheet">
<script src="../../site_libs/pagedtable-1.1/js/pagedtable.js"></script>
</head>
<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="navbar navbar-expand-lg navbar-dark "><div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">MyLabJournal</span>
    </a>
  </div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
<li class="nav-item">
    <a class="nav-link" href="../../index.html">
 <span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-journal" role="button" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Journal</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-journal">
<li>
    <a class="dropdown-item" href="../../content/01_journal/Machine_Learning_Fundamentals.html">
 <span class="dropdown-text">Machine Learning Fundamentals</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../content/01_journal/Regression.html">
 <span class="dropdown-text">Regression</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../content/01_journal/AutoML.html">
 <span class="dropdown-text">AutoML</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../content/01_journal/AutoML2PerfMeas.html">
 <span class="dropdown-text">AutoML Part 2 and Performance Measures</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../content/01_journal/LIME.html">
 <span class="dropdown-text">LIME</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../content/01_journal/DeepLearning.html">
 <span class="dropdown-text">Deep Learning</span></a>
  </li>  
    </ul>
</li>
  <li class="nav-item">
    <a class="nav-link" href="../../content/02_notes/05_class_notes.html">
 <span class="menu-text">Class notes</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../content/03_other/06_links.html">
 <span class="menu-text">Links</span></a>
  </li>  
</ul>
<div class="quarto-toggle-container">
                  <a href="" class="quarto-color-scheme-toggle nav-link" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
              </div>
              <div id="quarto-search" class="" title="Search"></div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav></header><!-- content --><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        
    </div>
<!-- main -->
<main class="content" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block default"><div class="quarto-title">
<h1 class="title">Deep Learning</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Fadel Victor Shanaa </p>
          </div>
  </div>
    
  
    
  </div>
  

</header><p><strong>Challenge Question:</strong></p>
<p>For the challenge we are using tabular data instead of images. The goal is to predict customer churn using deep learning with Keras. The objective is similar to the employee churn prediction from the last session.</p>
<p>Customer churn refers to the situation when a customer ends their relationship with a company, and it’s a costly problem. Customer churn is a problem that all companies need to monitor, especially those that depend on subscription-based revenue streams. Loss of customers impacts sales. We are using the keras package to produce an Artificial Neural Network (ANN) model on the IBM Watson Telco Customer Churn Data Set! As for most business problems, it’s equally important to explain what features drive the model, which is why we’ll use the lime package for explainability. Moreover, we are going to cross-check the LIME results with a Correlation Analysis.</p>
<p>Credit goes to Susan Li.</p>
<p>We need the following packages:</p>
<p>tidyverse: Loads dplyr, ggplot2 etc. for data wrangling and visualization keras: Ports Keras from Python enabling deep learning in R lime: Used to explain the predictions of black box classifiers recipes: package for preprocessing machine learning data sets rsample: Package for generating resamples yardstick: Tidy methods for measuring model performance corrr: Tidy methods for correlation</p>
<p>According to IBM, the business challenge is…</p>
<p>A telecommunications company [Telco] is concerned about the number of customers leaving their landline business for cable competitors. They need to understand who is leaving. Imagine that you’re an analyst at this company and you have to find out who is leaving and why.</p>
<p>The dataset includes information about:</p>
<p>Churn: Customers who left within the last month Services that each customer has signed up for (phone, internet, steaming, … ) Customer account information (duration, payment method, … ) Demographic info about customers (gender, age, … )</p>
<p><strong>Code Base: </strong></p>
<div class="cell" data-hash="DeepLearning_cache/html/unnamed-chunk-1_ac164fdd7eae68b9d362797017430f7f">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a><span class="co"># Load the libraries</span></span>
<span id="cb1-2"><a href="#cb1-2"></a></span>
<span id="cb1-3"><a href="#cb1-3"></a><span class="fu">suppressMessages</span>(<span class="fu">library</span>(tidyverse))</span>
<span id="cb1-4"><a href="#cb1-4"></a><span class="fu">suppressMessages</span>(<span class="fu">library</span>(keras))</span>
<span id="cb1-5"><a href="#cb1-5"></a><span class="fu">suppressMessages</span>(<span class="fu">library</span>(lime))</span>
<span id="cb1-6"><a href="#cb1-6"></a><span class="fu">suppressMessages</span>(<span class="fu">library</span>(rsample))</span>
<span id="cb1-7"><a href="#cb1-7"></a><span class="fu">suppressMessages</span>(<span class="fu">library</span>(recipes))</span>
<span id="cb1-8"><a href="#cb1-8"></a><span class="fu">suppressMessages</span>(<span class="fu">library</span>(yardstick))</span>
<span id="cb1-9"><a href="#cb1-9"></a><span class="fu">suppressMessages</span>(<span class="fu">library</span>(corrr))</span>
<span id="cb1-10"><a href="#cb1-10"></a></span>
<span id="cb1-11"><a href="#cb1-11"></a><span class="co"># Load the data</span></span>
<span id="cb1-12"><a href="#cb1-12"></a>churn_data_raw <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"C:</span><span class="sc">\\</span><span class="st">Users</span><span class="sc">\\</span><span class="st">fvsha</span><span class="sc">\\</span><span class="st">Documents</span><span class="sc">\\</span><span class="st">GitHub</span><span class="sc">\\</span><span class="st">ss23-bdml-VictorReaver1999</span><span class="sc">\\</span><span class="st">deep_learning_challenge</span><span class="sc">\\</span><span class="st">Customer-Churn.csv"</span>)</span>
<span id="cb1-13"><a href="#cb1-13"></a></span>
<span id="cb1-14"><a href="#cb1-14"></a><span class="co"># View the data</span></span>
<span id="cb1-15"><a href="#cb1-15"></a>churn_data_raw <span class="sc">%&gt;%</span> <span class="fu">glimpse</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; Rows: 7,043
#&gt; Columns: 21
#&gt; $ customerID       &lt;chr&gt; "7590-VHVEG", "5575-GNVDE", "3668-QPYBK", "7795-CFOCW…
#&gt; $ gender           &lt;chr&gt; "Female", "Male", "Male", "Male", "Female", "Female",…
#&gt; $ SeniorCitizen    &lt;int&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,…
#&gt; $ Partner          &lt;chr&gt; "Yes", "No", "No", "No", "No", "No", "No", "No", "Yes…
#&gt; $ Dependents       &lt;chr&gt; "No", "No", "No", "No", "No", "No", "Yes", "No", "No"…
#&gt; $ tenure           &lt;int&gt; 1, 34, 2, 45, 2, 8, 22, 10, 28, 62, 13, 16, 58, 49, 2…
#&gt; $ PhoneService     &lt;chr&gt; "No", "Yes", "Yes", "No", "Yes", "Yes", "Yes", "No", …
#&gt; $ MultipleLines    &lt;chr&gt; "No phone service", "No", "No", "No phone service", "…
#&gt; $ InternetService  &lt;chr&gt; "DSL", "DSL", "DSL", "DSL", "Fiber optic", "Fiber opt…
#&gt; $ OnlineSecurity   &lt;chr&gt; "No", "Yes", "Yes", "Yes", "No", "No", "No", "Yes", "…
#&gt; $ OnlineBackup     &lt;chr&gt; "Yes", "No", "Yes", "No", "No", "No", "Yes", "No", "N…
#&gt; $ DeviceProtection &lt;chr&gt; "No", "Yes", "No", "Yes", "No", "Yes", "No", "No", "Y…
#&gt; $ TechSupport      &lt;chr&gt; "No", "No", "No", "Yes", "No", "No", "No", "No", "Yes…
#&gt; $ StreamingTV      &lt;chr&gt; "No", "No", "No", "No", "No", "Yes", "Yes", "No", "Ye…
#&gt; $ StreamingMovies  &lt;chr&gt; "No", "No", "No", "No", "No", "Yes", "No", "No", "Yes…
#&gt; $ Contract         &lt;chr&gt; "Month-to-month", "One year", "Month-to-month", "One …
#&gt; $ PaperlessBilling &lt;chr&gt; "Yes", "No", "Yes", "No", "Yes", "Yes", "Yes", "No", …
#&gt; $ PaymentMethod    &lt;chr&gt; "Electronic check", "Mailed check", "Mailed check", "…
#&gt; $ MonthlyCharges   &lt;dbl&gt; 29.85, 56.95, 53.85, 42.30, 70.70, 99.65, 89.10, 29.7…
#&gt; $ TotalCharges     &lt;dbl&gt; 29.85, 1889.50, 108.15, 1840.75, 151.65, 820.50, 1949…
#&gt; $ Churn            &lt;chr&gt; "No", "No", "Yes", "No", "Yes", "Yes", "No", "No", "Y…</code></pre>
</div>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1"></a><span class="co"># Filter the data</span></span>
<span id="cb3-2"><a href="#cb3-2"></a>churn_data_tbl <span class="ot">&lt;-</span> churn_data_raw <span class="sc">%&gt;%</span></span>
<span id="cb3-3"><a href="#cb3-3"></a>  <span class="fu">select</span>(Churn, <span class="fu">everything</span>(), <span class="sc">-</span>customerID) <span class="sc">%&gt;%</span></span>
<span id="cb3-4"><a href="#cb3-4"></a>  tidyr<span class="sc">::</span><span class="fu">drop_na</span>()</span>
<span id="cb3-5"><a href="#cb3-5"></a></span>
<span id="cb3-6"><a href="#cb3-6"></a><span class="co"># Split test/training sets</span></span>
<span id="cb3-7"><a href="#cb3-7"></a><span class="fu">set.seed</span>(<span class="dv">100</span>)</span>
<span id="cb3-8"><a href="#cb3-8"></a>train_test_split <span class="ot">&lt;-</span> rsample<span class="sc">::</span><span class="fu">initial_split</span>(churn_data_tbl, <span class="at">prop =</span><span class="fl">0.8</span>)</span>
<span id="cb3-9"><a href="#cb3-9"></a>train_test_split</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; &lt;Training/Testing/Total&gt;
#&gt; &lt;5625/1407/7032&gt;</code></pre>
</div>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1"></a><span class="do">## &lt;Analysis/Assess/Total&gt;</span></span>
<span id="cb5-2"><a href="#cb5-2"></a><span class="do">## &lt;5626/1406/7032&gt;</span></span>
<span id="cb5-3"><a href="#cb5-3"></a></span>
<span id="cb5-4"><a href="#cb5-4"></a><span class="co"># Retrieve train and test sets</span></span>
<span id="cb5-5"><a href="#cb5-5"></a>train_tbl <span class="ot">&lt;-</span> <span class="fu">training</span>(train_test_split)</span>
<span id="cb5-6"><a href="#cb5-6"></a>test_tbl  <span class="ot">&lt;-</span> <span class="fu">testing</span>(train_test_split)</span>
<span id="cb5-7"><a href="#cb5-7"></a></span>
<span id="cb5-8"><a href="#cb5-8"></a><span class="co"># Create two plots of tenure counts, one with and the other without binning</span></span>
<span id="cb5-9"><a href="#cb5-9"></a>counts_no_bins <span class="ot">&lt;-</span> churn_data_tbl <span class="sc">%&gt;%</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> tenure)) <span class="sc">+</span> </span>
<span id="cb5-10"><a href="#cb5-10"></a>  <span class="fu">geom_histogram</span>(<span class="at">binwidth =</span> <span class="fl">0.5</span>, <span class="at">fill =</span>  <span class="st">"#2DC6D6"</span>) <span class="sc">+</span></span>
<span id="cb5-11"><a href="#cb5-11"></a>  <span class="fu">labs</span>(</span>
<span id="cb5-12"><a href="#cb5-12"></a>    <span class="at">title =</span> <span class="st">"Tenure Counts Without Binning"</span>,</span>
<span id="cb5-13"><a href="#cb5-13"></a>    <span class="at">x     =</span> <span class="st">"tenure (month)"</span></span>
<span id="cb5-14"><a href="#cb5-14"></a>  )</span>
<span id="cb5-15"><a href="#cb5-15"></a></span>
<span id="cb5-16"><a href="#cb5-16"></a><span class="fu">ggsave</span>(<span class="st">"counts_no_bins.png"</span>, counts_no_bins)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>#&gt; Saving 7 x 5 in image</code></pre>
</div>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1"></a>counts_no_bins</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><a href="DeepLearning_files/figure-html/unnamed-chunk-1-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-1"><img src="DeepLearning_files/figure-html/unnamed-chunk-1-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1"></a>counts_6_bins <span class="ot">&lt;-</span> churn_data_tbl <span class="sc">%&gt;%</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> tenure)) <span class="sc">+</span> </span>
<span id="cb8-2"><a href="#cb8-2"></a>  <span class="fu">geom_histogram</span>(<span class="at">bins =</span> <span class="dv">6</span>, <span class="at">color =</span> <span class="st">"white"</span>, <span class="at">fill =</span>  <span class="st">"#2DC6D6"</span>) <span class="sc">+</span></span>
<span id="cb8-3"><a href="#cb8-3"></a>  <span class="fu">labs</span>(</span>
<span id="cb8-4"><a href="#cb8-4"></a>    <span class="at">title =</span> <span class="st">"Tenure Counts With Six Bins"</span>,</span>
<span id="cb8-5"><a href="#cb8-5"></a>    <span class="at">x     =</span> <span class="st">"tenure (month)"</span></span>
<span id="cb8-6"><a href="#cb8-6"></a>  )</span>
<span id="cb8-7"><a href="#cb8-7"></a></span>
<span id="cb8-8"><a href="#cb8-8"></a><span class="fu">ggsave</span>(<span class="st">"counts_6_bins.png"</span>, counts_6_bins)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>#&gt; Saving 7 x 5 in image</code></pre>
</div>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1"></a>counts_6_bins</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><a href="DeepLearning_files/figure-html/unnamed-chunk-1-2.png" class="lightbox" data-gallery="quarto-lightbox-gallery-2"><img src="DeepLearning_files/figure-html/unnamed-chunk-1-2.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1"></a><span class="co"># Create a plot of total charges</span></span>
<span id="cb11-2"><a href="#cb11-2"></a>total_chg_plot <span class="ot">&lt;-</span> churn_data_tbl <span class="sc">%&gt;%</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> TotalCharges)) <span class="sc">+</span> </span>
<span id="cb11-3"><a href="#cb11-3"></a>  <span class="fu">geom_histogram</span>(<span class="at">bins =</span> <span class="dv">100</span>, <span class="at">fill =</span>  <span class="st">"#2DC6D6"</span>) <span class="sc">+</span></span>
<span id="cb11-4"><a href="#cb11-4"></a>  <span class="fu">labs</span>(</span>
<span id="cb11-5"><a href="#cb11-5"></a>    <span class="at">title =</span> <span class="st">"TotalCharges Histogram, 100 bins"</span>,</span>
<span id="cb11-6"><a href="#cb11-6"></a>    <span class="at">x     =</span> <span class="st">"TotalCharges"</span></span>
<span id="cb11-7"><a href="#cb11-7"></a>  )</span>
<span id="cb11-8"><a href="#cb11-8"></a></span>
<span id="cb11-9"><a href="#cb11-9"></a><span class="fu">ggsave</span>(<span class="st">"total_chg_plot.png"</span>, total_chg_plot)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>#&gt; Saving 7 x 5 in image</code></pre>
</div>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1"></a>total_chg_plot</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><a href="DeepLearning_files/figure-html/unnamed-chunk-1-3.png" class="lightbox" data-gallery="quarto-lightbox-gallery-3"><img src="DeepLearning_files/figure-html/unnamed-chunk-1-3.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1"></a>churn_data_tbl_mod <span class="ot">&lt;-</span> churn_data_tbl <span class="sc">%&gt;%</span> </span>
<span id="cb14-2"><a href="#cb14-2"></a>  <span class="fu">mutate</span>(<span class="at">TotalCharges =</span> <span class="fu">log10</span>(TotalCharges))</span>
<span id="cb14-3"><a href="#cb14-3"></a>churn_data_tbl_mod <span class="sc">%&gt;%</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> TotalCharges)) <span class="sc">+</span> </span>
<span id="cb14-4"><a href="#cb14-4"></a>  <span class="fu">geom_histogram</span>(<span class="at">bins =</span> <span class="dv">100</span>, <span class="at">fill =</span>  <span class="st">"#2DC6D6"</span>) <span class="sc">+</span></span>
<span id="cb14-5"><a href="#cb14-5"></a>  <span class="fu">labs</span>(</span>
<span id="cb14-6"><a href="#cb14-6"></a>    <span class="at">title =</span> <span class="st">"TotalCharges Histogram, 100 bins"</span>,</span>
<span id="cb14-7"><a href="#cb14-7"></a>    <span class="at">x     =</span> <span class="st">"TotalCharges"</span></span>
<span id="cb14-8"><a href="#cb14-8"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><a href="DeepLearning_files/figure-html/unnamed-chunk-1-4.png" class="lightbox" data-gallery="quarto-lightbox-gallery-4"><img src="DeepLearning_files/figure-html/unnamed-chunk-1-4.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1"></a><span class="co"># Determine if log transformation improves correlation </span></span>
<span id="cb15-2"><a href="#cb15-2"></a><span class="co"># between TotalCharges and Churn</span></span>
<span id="cb15-3"><a href="#cb15-3"></a></span>
<span id="cb15-4"><a href="#cb15-4"></a>train_tbl <span class="sc">%&gt;%</span></span>
<span id="cb15-5"><a href="#cb15-5"></a>  <span class="fu">select</span>(Churn, TotalCharges) <span class="sc">%&gt;%</span></span>
<span id="cb15-6"><a href="#cb15-6"></a>  <span class="fu">mutate</span>(</span>
<span id="cb15-7"><a href="#cb15-7"></a>    <span class="at">Churn =</span> Churn <span class="sc">%&gt;%</span> <span class="fu">as.factor</span>() <span class="sc">%&gt;%</span> <span class="fu">as.numeric</span>(),</span>
<span id="cb15-8"><a href="#cb15-8"></a>    <span class="at">LogTotalCharges =</span> <span class="fu">log</span>(TotalCharges)</span>
<span id="cb15-9"><a href="#cb15-9"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb15-10"><a href="#cb15-10"></a>  <span class="fu">correlate</span>() <span class="sc">%&gt;%</span></span>
<span id="cb15-11"><a href="#cb15-11"></a>  <span class="fu">focus</span>(Churn) <span class="sc">%&gt;%</span></span>
<span id="cb15-12"><a href="#cb15-12"></a>  <span class="fu">fashion</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>#&gt; Correlation computed with
#&gt; • Method: 'pearson'
#&gt; • Missing treated using: 'pairwise.complete.obs'</code></pre>
</div>
<div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["term"],"name":[1],"type":["noquote"],"align":["right"]},{"label":["Churn"],"name":[2],"type":["noquote"],"align":["right"]}],"data":[{"1":"TotalCharges","2":"-.21"},{"1":"LogTotalCharges","2":"-.25"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1"></a>churn_data_tbl <span class="sc">%&gt;%</span> </span>
<span id="cb17-2"><a href="#cb17-2"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols      =</span> <span class="fu">c</span>(Contract, InternetService, MultipleLines, PaymentMethod), </span>
<span id="cb17-3"><a href="#cb17-3"></a>               <span class="at">names_to  =</span> <span class="st">"feature"</span>, </span>
<span id="cb17-4"><a href="#cb17-4"></a>               <span class="at">values_to =</span> <span class="st">"category"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb17-5"><a href="#cb17-5"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(category)) <span class="sc">+</span></span>
<span id="cb17-6"><a href="#cb17-6"></a>  <span class="fu">geom_bar</span>(<span class="at">fill =</span> <span class="st">"#2DC6D6"</span>) <span class="sc">+</span></span>
<span id="cb17-7"><a href="#cb17-7"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> feature, <span class="at">scales =</span> <span class="st">"free"</span>) <span class="sc">+</span></span>
<span id="cb17-8"><a href="#cb17-8"></a>  <span class="fu">labs</span>(</span>
<span id="cb17-9"><a href="#cb17-9"></a>    <span class="at">title =</span> <span class="st">"Features with multiple categories: Need to be one-hot encoded"</span></span>
<span id="cb17-10"><a href="#cb17-10"></a>  ) <span class="sc">+</span></span>
<span id="cb17-11"><a href="#cb17-11"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">25</span>, </span>
<span id="cb17-12"><a href="#cb17-12"></a>                                   <span class="at">hjust =</span> <span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><a href="DeepLearning_files/figure-html/unnamed-chunk-1-5.png" class="lightbox" data-gallery="quarto-lightbox-gallery-5"><img src="DeepLearning_files/figure-html/unnamed-chunk-1-5.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1"></a><span class="co"># Create recipe to transform our data</span></span>
<span id="cb18-2"><a href="#cb18-2"></a>rec_obj <span class="ot">&lt;-</span> <span class="fu">recipe</span>(Churn <span class="sc">~</span> ., <span class="at">data =</span> train_tbl) <span class="sc">%&gt;%</span></span>
<span id="cb18-3"><a href="#cb18-3"></a>  <span class="fu">step_rm</span>(Churn) <span class="sc">%&gt;%</span> </span>
<span id="cb18-4"><a href="#cb18-4"></a>  <span class="fu">step_discretize</span>(tenure, <span class="at">options =</span> <span class="fu">list</span>(<span class="at">cuts =</span> <span class="dv">6</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb18-5"><a href="#cb18-5"></a>  <span class="fu">step_log</span>(TotalCharges) <span class="sc">%&gt;%</span></span>
<span id="cb18-6"><a href="#cb18-6"></a>  <span class="fu">step_dummy</span>(<span class="fu">all_nominal</span>(), <span class="sc">-</span><span class="fu">all_outcomes</span>(), <span class="at">one_hot =</span> T) <span class="sc">%&gt;%</span></span>
<span id="cb18-7"><a href="#cb18-7"></a>  <span class="fu">step_center</span>(<span class="fu">all_predictors</span>(), <span class="sc">-</span><span class="fu">all_outcomes</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb18-8"><a href="#cb18-8"></a>  <span class="fu">step_scale</span>(<span class="fu">all_predictors</span>(), <span class="sc">-</span><span class="fu">all_outcomes</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb18-9"><a href="#cb18-9"></a>  <span class="fu">prep</span>(<span class="at">data =</span> train_tbl)</span>
<span id="cb18-10"><a href="#cb18-10"></a></span>
<span id="cb18-11"><a href="#cb18-11"></a><span class="co"># Apply the recipe</span></span>
<span id="cb18-12"><a href="#cb18-12"></a>x_train_tbl <span class="ot">&lt;-</span> <span class="fu">bake</span>( rec_obj , <span class="at">new_data =</span>  train_tbl)</span>
<span id="cb18-13"><a href="#cb18-13"></a>x_test_tbl  <span class="ot">&lt;-</span> <span class="fu">bake</span>( rec_obj , <span class="at">new_data =</span>  test_tbl)</span>
<span id="cb18-14"><a href="#cb18-14"></a></span>
<span id="cb18-15"><a href="#cb18-15"></a></span>
<span id="cb18-16"><a href="#cb18-16"></a>y_train_vec <span class="ot">&lt;-</span> <span class="fu">ifelse</span>( train_tbl<span class="sc">$</span>Churn <span class="sc">==</span> <span class="st">"Yes"</span>, <span class="cn">TRUE</span>, <span class="cn">FALSE</span> )</span>
<span id="cb18-17"><a href="#cb18-17"></a>y_test_vec  <span class="ot">&lt;-</span> <span class="fu">ifelse</span>( test_tbl<span class="sc">$</span>Churn  <span class="sc">==</span> <span class="st">"Yes"</span>, <span class="cn">TRUE</span>, <span class="cn">FALSE</span>)</span>
<span id="cb18-18"><a href="#cb18-18"></a></span>
<span id="cb18-19"><a href="#cb18-19"></a></span>
<span id="cb18-20"><a href="#cb18-20"></a><span class="co"># Building our Artificial Neural Network</span></span>
<span id="cb18-21"><a href="#cb18-21"></a>model_keras <span class="ot">&lt;-</span> <span class="fu">keras_model_sequential</span>()</span>
<span id="cb18-22"><a href="#cb18-22"></a></span>
<span id="cb18-23"><a href="#cb18-23"></a>model_keras <span class="sc">%&gt;%</span> </span>
<span id="cb18-24"><a href="#cb18-24"></a>  <span class="co"># First hidden layer</span></span>
<span id="cb18-25"><a href="#cb18-25"></a>  <span class="fu">layer_dense</span>(</span>
<span id="cb18-26"><a href="#cb18-26"></a>    <span class="at">units              =</span> <span class="dv">16</span>, </span>
<span id="cb18-27"><a href="#cb18-27"></a>    <span class="at">kernel_initializer =</span> <span class="st">"uniform"</span>, </span>
<span id="cb18-28"><a href="#cb18-28"></a>    <span class="at">activation         =</span> <span class="st">"relu"</span>,</span>
<span id="cb18-29"><a href="#cb18-29"></a>    <span class="at">input_shape        =</span> <span class="fu">ncol</span>(x_train_tbl))<span class="sc">%&gt;%</span> </span>
<span id="cb18-30"><a href="#cb18-30"></a>  <span class="co"># Dropout to prevent overfitting</span></span>
<span id="cb18-31"><a href="#cb18-31"></a>  <span class="fu">layer_dropout</span>(<span class="at">rate =</span> <span class="fl">0.1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb18-32"><a href="#cb18-32"></a>  <span class="co"># Second hidden layer</span></span>
<span id="cb18-33"><a href="#cb18-33"></a>  <span class="fu">layer_dense</span>(</span>
<span id="cb18-34"><a href="#cb18-34"></a>    <span class="at">units              =</span> <span class="dv">16</span>, </span>
<span id="cb18-35"><a href="#cb18-35"></a>    <span class="at">kernel_initializer =</span> <span class="st">"uniform"</span>, </span>
<span id="cb18-36"><a href="#cb18-36"></a>    <span class="at">activation         =</span> <span class="st">"relu"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb18-37"><a href="#cb18-37"></a>  <span class="co"># Dropout to prevent overfitting</span></span>
<span id="cb18-38"><a href="#cb18-38"></a>  <span class="fu">layer_dropout</span>(<span class="at">rate =</span> <span class="fl">0.1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb18-39"><a href="#cb18-39"></a>  <span class="co"># Output layer</span></span>
<span id="cb18-40"><a href="#cb18-40"></a>  <span class="fu">layer_dense</span>(</span>
<span id="cb18-41"><a href="#cb18-41"></a>    <span class="at">units              =</span> <span class="dv">1</span>, </span>
<span id="cb18-42"><a href="#cb18-42"></a>    <span class="at">kernel_initializer =</span> <span class="st">"uniform"</span>, </span>
<span id="cb18-43"><a href="#cb18-43"></a>    <span class="at">activation         =</span> <span class="st">"sigmoid"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb18-44"><a href="#cb18-44"></a>  <span class="co"># Compile ANN</span></span>
<span id="cb18-45"><a href="#cb18-45"></a>  <span class="fu">compile</span>(</span>
<span id="cb18-46"><a href="#cb18-46"></a>    <span class="at">optimizer =</span> <span class="st">'adam'</span>,</span>
<span id="cb18-47"><a href="#cb18-47"></a>    <span class="at">loss      =</span> <span class="st">'binary_crossentropy'</span>,</span>
<span id="cb18-48"><a href="#cb18-48"></a>    <span class="at">metrics   =</span> <span class="fu">c</span>(<span class="st">'accuracy'</span>)</span>
<span id="cb18-49"><a href="#cb18-49"></a>  )</span>
<span id="cb18-50"><a href="#cb18-50"></a></span>
<span id="cb18-51"><a href="#cb18-51"></a>model_keras</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; Model: "sequential"
#&gt; ________________________________________________________________________________
#&gt;  Layer (type)                       Output Shape                    Param #     
#&gt; ================================================================================
#&gt;  dense_2 (Dense)                    (None, 16)                      816         
#&gt;  dropout_1 (Dropout)                (None, 16)                      0           
#&gt;  dense_1 (Dense)                    (None, 16)                      272         
#&gt;  dropout (Dropout)                  (None, 16)                      0           
#&gt;  dense (Dense)                      (None, 1)                       17          
#&gt; ================================================================================
#&gt; Total params: 1,105
#&gt; Trainable params: 1,105
#&gt; Non-trainable params: 0
#&gt; ________________________________________________________________________________</code></pre>
</div>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1"></a><span class="co"># I managed to get to this point, but ran into an error that concerns dense_2_input.</span></span>
<span id="cb20-2"><a href="#cb20-2"></a><span class="co"># The rest of the code may be right or wrong, but it's hard to tell without being able to execute it.</span></span>
<span id="cb20-3"><a href="#cb20-3"></a><span class="co"># In theory, it should give the results we need. In view of not being able to train the model, I have</span></span>
<span id="cb20-4"><a href="#cb20-4"></a><span class="co"># decided to stop at this point. The rest of the code will be below, but it's commented out or the rendering and execution will never occur since </span></span>
<span id="cb20-5"><a href="#cb20-5"></a><span class="co"># it keeps failing at the training step</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Code Base Part 2 (Not Working, Commented out): </strong></p>
<div class="cell" data-hash="DeepLearning_cache/html/unnamed-chunk-2_311829342baf2a1502690f72ba1cb49e">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1"></a><span class="co"># x_train_mrx = as.matrix(x_train_tbl)</span></span>
<span id="cb21-2"><a href="#cb21-2"></a><span class="co"># </span></span>
<span id="cb21-3"><a href="#cb21-3"></a><span class="co"># ncol(x_train_tbl)</span></span>
<span id="cb21-4"><a href="#cb21-4"></a><span class="co"># </span></span>
<span id="cb21-5"><a href="#cb21-5"></a><span class="co"># # Fit the model</span></span>
<span id="cb21-6"><a href="#cb21-6"></a><span class="co"># fit_keras &lt;- keras::fit(</span></span>
<span id="cb21-7"><a href="#cb21-7"></a><span class="co">#   object = model_keras,</span></span>
<span id="cb21-8"><a href="#cb21-8"></a><span class="co">#   x = x_train_tbl,</span></span>
<span id="cb21-9"><a href="#cb21-9"></a><span class="co">#   y = y_train_vec ,</span></span>
<span id="cb21-10"><a href="#cb21-10"></a><span class="co">#   epochs = 35 ,</span></span>
<span id="cb21-11"><a href="#cb21-11"></a><span class="co">#   batch_size = 50 ,</span></span>
<span id="cb21-12"><a href="#cb21-12"></a><span class="co">#   validation_split = 0.3</span></span>
<span id="cb21-13"><a href="#cb21-13"></a><span class="co"># )</span></span>
<span id="cb21-14"><a href="#cb21-14"></a><span class="co"># </span></span>
<span id="cb21-15"><a href="#cb21-15"></a><span class="co"># # View fit data</span></span>
<span id="cb21-16"><a href="#cb21-16"></a><span class="co"># fit_keras</span></span>
<span id="cb21-17"><a href="#cb21-17"></a><span class="co"># </span></span>
<span id="cb21-18"><a href="#cb21-18"></a><span class="co"># plot(fit_keras) +</span></span>
<span id="cb21-19"><a href="#cb21-19"></a><span class="co">#   labs(title = "Deep Learning Training Results") +</span></span>
<span id="cb21-20"><a href="#cb21-20"></a><span class="co">#   theme(legend.position  = "bottom",</span></span>
<span id="cb21-21"><a href="#cb21-21"></a><span class="co">#         strip.placement  = "inside",</span></span>
<span id="cb21-22"><a href="#cb21-22"></a><span class="co">#         strip.background = element_rect(fill = "#grey"))</span></span>
<span id="cb21-23"><a href="#cb21-23"></a><span class="co"># </span></span>
<span id="cb21-24"><a href="#cb21-24"></a><span class="co"># # Predicted Class</span></span>
<span id="cb21-25"><a href="#cb21-25"></a><span class="co"># yhat_keras_class_vec &lt;- predict_classes(object = model_keras, x = as.matrix(x_test_tbl)) %&gt;%</span></span>
<span id="cb21-26"><a href="#cb21-26"></a><span class="co">#   as.vector()</span></span>
<span id="cb21-27"><a href="#cb21-27"></a><span class="co"># </span></span>
<span id="cb21-28"><a href="#cb21-28"></a><span class="co"># # Predicted Class Probability</span></span>
<span id="cb21-29"><a href="#cb21-29"></a><span class="co"># yhat_keras_prob_vec  &lt;- predict_proba(object = model_keras, x = as.matrix(x_test_tbl)) %&gt;%</span></span>
<span id="cb21-30"><a href="#cb21-30"></a><span class="co">#   as.vector()</span></span>
<span id="cb21-31"><a href="#cb21-31"></a><span class="co"># </span></span>
<span id="cb21-32"><a href="#cb21-32"></a><span class="co"># # Format test data and predictions for yardstick metrics</span></span>
<span id="cb21-33"><a href="#cb21-33"></a><span class="co"># estimates_keras_tbl &lt;- tibble(</span></span>
<span id="cb21-34"><a href="#cb21-34"></a><span class="co">#   truth      = as.factor(y_test_vec) %&gt;% fct_recode(yes = "1", no = "0"),</span></span>
<span id="cb21-35"><a href="#cb21-35"></a><span class="co">#   estimate   = as.factor(yhat_keras_class_vec) %&gt;% fct_recode(yes = "1", no = "0"),</span></span>
<span id="cb21-36"><a href="#cb21-36"></a><span class="co">#   class_prob = yhat_keras_prob_vec</span></span>
<span id="cb21-37"><a href="#cb21-37"></a><span class="co"># )</span></span>
<span id="cb21-38"><a href="#cb21-38"></a><span class="co"># </span></span>
<span id="cb21-39"><a href="#cb21-39"></a><span class="co"># estimates_keras_tbl</span></span>
<span id="cb21-40"><a href="#cb21-40"></a><span class="co"># </span></span>
<span id="cb21-41"><a href="#cb21-41"></a><span class="co"># # Confusion Table</span></span>
<span id="cb21-42"><a href="#cb21-42"></a><span class="co"># estimates_keras_tbl %&gt;% conf_mat(</span></span>
<span id="cb21-43"><a href="#cb21-43"></a><span class="co">#   truth,</span></span>
<span id="cb21-44"><a href="#cb21-44"></a><span class="co">#   estimate)</span></span>
<span id="cb21-45"><a href="#cb21-45"></a><span class="co"># </span></span>
<span id="cb21-46"><a href="#cb21-46"></a><span class="co"># # Accuracy</span></span>
<span id="cb21-47"><a href="#cb21-47"></a><span class="co"># estimates_keras_tbl %&gt;% accuracy(truth, estimate)</span></span>
<span id="cb21-48"><a href="#cb21-48"></a><span class="co"># </span></span>
<span id="cb21-49"><a href="#cb21-49"></a><span class="co"># # AUC</span></span>
<span id="cb21-50"><a href="#cb21-50"></a><span class="co"># estimates_keras_tbl %&gt;% roc_auc(</span></span>
<span id="cb21-51"><a href="#cb21-51"></a><span class="co">#   data,</span></span>
<span id="cb21-52"><a href="#cb21-52"></a><span class="co">#   truth,</span></span>
<span id="cb21-53"><a href="#cb21-53"></a><span class="co">#   event_level = "second")</span></span>
<span id="cb21-54"><a href="#cb21-54"></a><span class="co"># </span></span>
<span id="cb21-55"><a href="#cb21-55"></a><span class="co"># # Precision</span></span>
<span id="cb21-56"><a href="#cb21-56"></a><span class="co"># tibble(</span></span>
<span id="cb21-57"><a href="#cb21-57"></a><span class="co">#   precision = precision(</span></span>
<span id="cb21-58"><a href="#cb21-58"></a><span class="co">#     data,</span></span>
<span id="cb21-59"><a href="#cb21-59"></a><span class="co">#     truth),</span></span>
<span id="cb21-60"><a href="#cb21-60"></a><span class="co">#   recall    = recall(</span></span>
<span id="cb21-61"><a href="#cb21-61"></a><span class="co">#     data,</span></span>
<span id="cb21-62"><a href="#cb21-62"></a><span class="co">#     truth)</span></span>
<span id="cb21-63"><a href="#cb21-63"></a><span class="co"># )</span></span>
<span id="cb21-64"><a href="#cb21-64"></a><span class="co"># </span></span>
<span id="cb21-65"><a href="#cb21-65"></a><span class="co"># # F1-Statistic</span></span>
<span id="cb21-66"><a href="#cb21-66"></a><span class="co"># estimates_keras_tbl %&gt;% f_meas(truth, estimate, beta = 1)</span></span>
<span id="cb21-67"><a href="#cb21-67"></a><span class="co"># </span></span>
<span id="cb21-68"><a href="#cb21-68"></a><span class="co"># class(model_keras)</span></span>
<span id="cb21-69"><a href="#cb21-69"></a><span class="co"># </span></span>
<span id="cb21-70"><a href="#cb21-70"></a><span class="co"># # Setup lime::model_type() function for keras</span></span>
<span id="cb21-71"><a href="#cb21-71"></a><span class="co"># model_type.keras.engine.sequential.Sequential  &lt;- function(x, ...) {</span></span>
<span id="cb21-72"><a href="#cb21-72"></a><span class="co">#   return("classification")</span></span>
<span id="cb21-73"><a href="#cb21-73"></a><span class="co"># }</span></span>
<span id="cb21-74"><a href="#cb21-74"></a><span class="co"># </span></span>
<span id="cb21-75"><a href="#cb21-75"></a><span class="co"># # Setup lime::predict_model() function for keras</span></span>
<span id="cb21-76"><a href="#cb21-76"></a><span class="co"># predict_model.keras.engine.sequential.Sequential &lt;- function(x, newdata, type, ...) {</span></span>
<span id="cb21-77"><a href="#cb21-77"></a><span class="co">#   pred &lt;- predict_proba(object = x, x = as.matrix(newdata))</span></span>
<span id="cb21-78"><a href="#cb21-78"></a><span class="co">#   return(data.frame(Yes = pred, No = 1 - pred))</span></span>
<span id="cb21-79"><a href="#cb21-79"></a><span class="co"># }</span></span>
<span id="cb21-80"><a href="#cb21-80"></a><span class="co"># </span></span>
<span id="cb21-81"><a href="#cb21-81"></a><span class="co"># library(lime)</span></span>
<span id="cb21-82"><a href="#cb21-82"></a><span class="co"># # Test our predict_model() function</span></span>
<span id="cb21-83"><a href="#cb21-83"></a><span class="co"># predict_model(x = model_keras, newdata = x_test_tbl, type = 'raw') %&gt;%</span></span>
<span id="cb21-84"><a href="#cb21-84"></a><span class="co">#   tibble::as_tibble()</span></span>
<span id="cb21-85"><a href="#cb21-85"></a><span class="co"># </span></span>
<span id="cb21-86"><a href="#cb21-86"></a><span class="co"># # Run lime() on training set</span></span>
<span id="cb21-87"><a href="#cb21-87"></a><span class="co"># explainer &lt;- lime::lime(</span></span>
<span id="cb21-88"><a href="#cb21-88"></a><span class="co">#   x_train_tbl,</span></span>
<span id="cb21-89"><a href="#cb21-89"></a><span class="co">#   y_train_vec ,</span></span>
<span id="cb21-90"><a href="#cb21-90"></a><span class="co">#   bin_continuous = FALSE)</span></span>
<span id="cb21-91"><a href="#cb21-91"></a><span class="co"># </span></span>
<span id="cb21-92"><a href="#cb21-92"></a><span class="co"># explanation &lt;- lime::explain(</span></span>
<span id="cb21-93"><a href="#cb21-93"></a><span class="co">#   x_test_tbl[1:10,],</span></span>
<span id="cb21-94"><a href="#cb21-94"></a><span class="co">#   explainer = explainer,</span></span>
<span id="cb21-95"><a href="#cb21-95"></a><span class="co">#   n_labels   = 1,</span></span>
<span id="cb21-96"><a href="#cb21-96"></a><span class="co">#   n_features = 51,</span></span>
<span id="cb21-97"><a href="#cb21-97"></a><span class="co">#   kernel_width   = 1)</span></span>
<span id="cb21-98"><a href="#cb21-98"></a><span class="co"># </span></span>
<span id="cb21-99"><a href="#cb21-99"></a><span class="co"># # Feature correlations to Churn</span></span>
<span id="cb21-100"><a href="#cb21-100"></a><span class="co"># corrr_analysis &lt;- x_train_tbl %&gt;%</span></span>
<span id="cb21-101"><a href="#cb21-101"></a><span class="co">#   mutate(Churn = y_train_vec) %&gt;%</span></span>
<span id="cb21-102"><a href="#cb21-102"></a><span class="co">#   correlate() %&gt;%</span></span>
<span id="cb21-103"><a href="#cb21-103"></a><span class="co">#   focus(Churn) %&gt;%</span></span>
<span id="cb21-104"><a href="#cb21-104"></a><span class="co">#   rename(feature = rowname) %&gt;%</span></span>
<span id="cb21-105"><a href="#cb21-105"></a><span class="co">#   arrange(abs(Churn)) %&gt;%</span></span>
<span id="cb21-106"><a href="#cb21-106"></a><span class="co">#   mutate(feature = as_factor(feature))</span></span>
<span id="cb21-107"><a href="#cb21-107"></a><span class="co"># corrr_analysis</span></span>
<span id="cb21-108"><a href="#cb21-108"></a><span class="co"># </span></span>
<span id="cb21-109"><a href="#cb21-109"></a><span class="co"># # Correlation visualization</span></span>
<span id="cb21-110"><a href="#cb21-110"></a><span class="co"># corrr_plot &lt;- corrr_analysis %&gt;%</span></span>
<span id="cb21-111"><a href="#cb21-111"></a><span class="co">#   ggplot(aes(x = ..., y = fct_reorder(..., desc(...)))) +</span></span>
<span id="cb21-112"><a href="#cb21-112"></a><span class="co">#   geom_point() +</span></span>
<span id="cb21-113"><a href="#cb21-113"></a><span class="co">#   </span></span>
<span id="cb21-114"><a href="#cb21-114"></a><span class="co">#   # Positive Correlations - Contribute to churn</span></span>
<span id="cb21-115"><a href="#cb21-115"></a><span class="co">#   geom_segment(aes(xend = ..., yend = ...),</span></span>
<span id="cb21-116"><a href="#cb21-116"></a><span class="co">#                color = "red",</span></span>
<span id="cb21-117"><a href="#cb21-117"></a><span class="co">#                data = corrr_analysis %&gt;% filter(... &gt; ...)) +</span></span>
<span id="cb21-118"><a href="#cb21-118"></a><span class="co">#   geom_point(color = "red",</span></span>
<span id="cb21-119"><a href="#cb21-119"></a><span class="co">#              data = corrr_analysis %&gt;% filter(... &gt; ...)) +</span></span>
<span id="cb21-120"><a href="#cb21-120"></a><span class="co">#   </span></span>
<span id="cb21-121"><a href="#cb21-121"></a><span class="co">#   # Negative Correlations - Prevent churn</span></span>
<span id="cb21-122"><a href="#cb21-122"></a><span class="co">#   geom_segment(aes(xend = 0, yend = feature),</span></span>
<span id="cb21-123"><a href="#cb21-123"></a><span class="co">#                color = "#2DC6D6",</span></span>
<span id="cb21-124"><a href="#cb21-124"></a><span class="co">#                data = ...) +</span></span>
<span id="cb21-125"><a href="#cb21-125"></a><span class="co">#   geom_point(color = "#2DC6D6",</span></span>
<span id="cb21-126"><a href="#cb21-126"></a><span class="co">#              data = ...) +</span></span>
<span id="cb21-127"><a href="#cb21-127"></a><span class="co">#   </span></span>
<span id="cb21-128"><a href="#cb21-128"></a><span class="co">#   # Vertical lines</span></span>
<span id="cb21-129"><a href="#cb21-129"></a><span class="co">#   geom_vline(xintercept = 0, color = "#f1fa8c", size = 1, linetype = 2) +</span></span>
<span id="cb21-130"><a href="#cb21-130"></a><span class="co">#   geom_vline( ... ) +</span></span>
<span id="cb21-131"><a href="#cb21-131"></a><span class="co">#   geom_vline( ... ) +</span></span>
<span id="cb21-132"><a href="#cb21-132"></a><span class="co">#   </span></span>
<span id="cb21-133"><a href="#cb21-133"></a><span class="co">#   # Aesthetics</span></span>
<span id="cb21-134"><a href="#cb21-134"></a><span class="co">#   labs( ... )</span></span>
<span id="cb21-135"><a href="#cb21-135"></a><span class="co"># </span></span>
<span id="cb21-136"><a href="#cb21-136"></a><span class="co"># # Save the plot</span></span>
<span id="cb21-137"><a href="#cb21-137"></a><span class="co"># ggsave("corrr_plot.png", corrr_plot)</span></span>
<span id="cb21-138"><a href="#cb21-138"></a><span class="co"># </span></span>
<span id="cb21-139"><a href="#cb21-139"></a><span class="co"># # View the plot</span></span>
<span id="cb21-140"><a href="#cb21-140"></a><span class="co"># corrr_plot</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>End of Deep Learning Challenge and BDML Course</strong></p>



</main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  let localAlternateSentinel = 'alternate';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->
<script>var lightboxQuarto = GLightbox({"openEffect":"zoom","closeEffect":"zoom","loop":true,"selector":".lightbox","descPosition":"bottom"});</script>


</body></html>